# 项目准备：架构图、数据与反思

## 一、项目背景与业务价值

### 1.1 项目背景

**问题**:

- 传统医疗咨询：排队时间长、成本高、24 小时服务难
- 用户痛点：轻症不知道该不该去医院、半夜不舒服没地方问
- 医疗资源：分布不均，基层医疗能力不足

**解决方案**:

- AI 智能问诊：7×24 小时在线、即时响应、成本低
- RAG 技术：基于权威医学知识库，减少幻觉
- Multi-Agent：模拟医生问诊流程，提供专业建议

### 1.2 业务价值

**用户价值**:

- 快速获得专业建议（平均 5 分钟 vs 传统 15 分钟）
- 降低就医成本（免费咨询 vs 挂号费 50-200 元）
- 24 小时随时可用

**商业价值**:

- 日均 10 万+问诊，月活 50 万+
- 付费转化率 20%（高级功能）
- 降低人工客服成本 60%

**社会价值**:

- 缓解医疗资源紧张
- 提高基层医疗可及性
- 健康教育普及

---

## 二、技术架构图（手绘版）

### 2.1 整体架构

```
面试时可以这样画:

┌─────────────────────────────────────────────────┐
│                   用户端                         │
│              (React + Socket.io)                │
└────────────────┬────────────────────────────────┘
                 │ HTTPS/WSS
                 ↓
┌─────────────────────────────────────────────────┐
│              Nginx (负载均衡)                    │
└────────────────┬────────────────────────────────┘
                 │
        ┌────────┴────────┐
        ↓                 ↓
┌──────────────┐   ┌──────────────┐
│  Backend 1   │   │  Backend 2   │  (NestJS)
└──────┬───────┘   └──────┬───────┘
       │                  │
       └────────┬─────────┘
                ↓
┌─────────────────────────────────────────────────┐
│              核心服务层                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │ AI Agent │  │   RAG    │  │ WebSocket│      │
│  └──────────┘  └──────────┘  └──────────┘      │
└────────────────┬────────────────────────────────┘
                 │
        ┌────────┴────────┬────────┬────────┐
        ↓                 ↓        ↓        ↓
   ┌────────┐      ┌─────────┐  ┌────┐  ┌────────┐
   │PostgreSQL│     │ ChromaDB│  │Redis│ │ Bull   │
   │(主从)   │     │(向量DB) │  │     │ │ Queue  │
   └────────┘      └─────────┘  └────┘  └────────┘
                         │
                         ↓
                  ┌──────────────┐
                  │ OpenAI/Qwen  │
                  │  (LLM APIs)  │
                  └──────────────┘
```

### 2.2 RAG 系统架构

```
┌─────────────────────────────────────────────────┐
│                 RAG Pipeline                     │
└─────────────────────────────────────────────────┘

离线阶段（索引构建）:
┌──────────┐    ┌──────────┐    ┌──────────┐
│ 医学文档  │ →  │ 文本分块  │ →  │ Embedding│
│ (PDF等)  │    │ (1000字) │    │ (1536维) │
└──────────┘    └──────────┘    └──────────┘
                                      ↓
                               ┌──────────┐
                               │ ChromaDB │
                               │ (HNSW)   │
                               └──────────┘

在线阶段（查询）:
┌──────────┐    ┌──────────┐    ┌──────────┐
│ 用户问题  │ →  │ Embedding│ →  │ 向量检索  │
└──────────┘    └──────────┘    │ + BM25   │
                                └────┬─────┘
                                     ↓
                               ┌──────────┐
                               │ 重排序    │
                               │ Top 5    │
                               └────┬─────┘
                                     ↓
                               ┌──────────┐
                               │ Prompt   │
                               │ + LLM    │
                               └────┬─────┘
                                     ↓
                               ┌──────────┐
                               │ 最终答案  │
                               └──────────┘
```

### 2.3 Multi-Agent 架构

```
┌─────────────────────────────────────────────────┐
│              Multi-Agent System                  │
└─────────────────────────────────────────────────┘

用户输入: "我头痛、发烧、咳嗽"
    ↓
┌──────────────────┐
│ StrategistAgent  │  策略分析
│ (策略制定)        │
└────────┬─────────┘
         │ 输出: 问题列表、初步分析
         ↓
┌──────────────────┐
│  RolePlayAgent   │  对话管理
│ (多轮问诊)        │
└────────┬─────────┘
         │ 输出: 详细症状信息
         ↓
┌──────────────────┐
│ PitchPerfectAgent│  反馈优化
│ (建议生成)        │
└────────┬─────────┘
         │ 输出: 最终健康建议
         ↓
    返回给用户
```

---

## 三、核心技术难点与解决方案

### 3.1 难点 1：大模型幻觉问题

**问题描述**:

- LLM 容易编造不存在的医学信息
- 医疗场景对准确性要求极高
- 错误建议可能导致严重后果

**解决方案**:

```
1. RAG锚定
   - 所有回答必须基于知识库
   - 知识库来源：权威医学教材、指南
   - 检索召回率90%

2. 多轮验证
   - 关键信息交叉验证
   - 置信度评分
   - 低置信度时建议就医

3. 人工审核
   - 定期review bad cases
   - 更新知识库
   - 优化Prompt

4. 免责声明
   - 明确AI只是辅助工具
   - 严重症状必须就医
   - 不替代医生诊断
```

**效果**:

- 准确率从 70%提升到 85%
- 用户投诉率下降 60%
- 医疗纠纷 0 起

### 3.2 难点 2：高并发下的成本控制

**问题描述**:

- GPT-4 调用成本高（$0.03/1K tokens）
- 日均 10 万请求，月成本可达$10 万+
- 需要在成本和质量间平衡

**解决方案**:

```
1. 智能模型选择
   场景              模型        成本
   ─────────────────────────────────
   症状提取         GPT-3.5     低
   简单问答         GPT-3.5     低
   复杂诊断         GPT-4       高
   紧急情况         GPT-4       高

2. 三级缓存
   - 本地缓存: 热点问题（命中率20%）
   - Redis缓存: 相似问题（命中率30%）
   - 向量缓存: Embedding复用（命中率50%）

   总命中率: 40%，节省成本40%

3. Prompt优化
   - 精简Prompt长度（-25% tokens）
   - 结构化输出（减少重复）
   - Few-shot优化（2-3个例子）

4. 批量处理
   - 合并相似请求
   - 批量Embedding
   - 异步处理非紧急任务
```

**效果**:

- 月成本从$10 万降到$6 万
- 在流量增长 3 倍的情况下，成本仅增长 1.5 倍
- ROI 提升 2 倍

### 3.3 难点 3：实时性与准确性的平衡

**问题描述**:

- 用户期望快速响应（<3 秒）
- 复杂问诊需要多步推理（可能>10 秒）
- 如何在速度和质量间平衡？

**解决方案**:

```
1. 流式输出
   - 边生成边输出
   - 首字延迟<500ms
   - 用户感知延迟大幅降低

2. 异步处理
   - 快速返回初步建议
   - 后台生成详细报告
   - 完成后推送通知

3. 并行执行
   - 向量检索 + BM25检索并行
   - 多个Agent并行分析
   - 总延迟 = max(各步骤) 而非 sum

4. 预计算
   - 常见症状预先分析
   - 热门问题预生成答案
   - 缓存命中直接返回
```

**效果**:

- 端到端延迟从 8 秒降到 3 秒
- 首字延迟<500ms
- 用户满意度从 3.8 提升到 4.5

---

## 四、量化数据与成果

### 4.1 性能指标

```
系统性能:
- 日均请求: 10万+
- 峰值QPS: 500
- P50延迟: 1.5秒
- P99延迟: 3秒
- 可用性: 99.9%

RAG系统:
- 召回率: 90%
- 检索延迟: P99 < 100ms
- 缓存命中率: 40%

AI调用:
- 月调用量: 300万次
- 平均Token: 1500/次
- 成本: $6万/月
- 成本优化: 40%
```

### 4.2 业务指标

```
用户数据:
- 月活用户: 50万+
- 日活用户: 10万+
- 用户留存: D7 45%, D30 25%
- 用户满意度: 4.5/5.0

业务数据:
- 问诊准确率: 85%
- 平均问诊时长: 5分钟
- 付费转化率: 20%
- 客服成本降低: 60%
```

### 4.3 技术指标

```
代码质量:
- 测试覆盖率: 75%
- 代码审查: 100%
- 技术债务: 低

团队效率:
- 迭代周期: 2周
- 部署频率: 每天3次
- 故障恢复: MTTR < 5分钟
```

---

## 五、失败经历与反思

### 5.1 失败案例 1：过度依赖 GPT-4

**背景**:

- 项目初期，所有场景都用 GPT-4
- 追求最高质量

**问题**:

- 成本激增，月成本$15 万
- 延迟较高，P99 > 5 秒
- ROI 不理想

**反思**:

```
1. 没有做成本分析
   - 应该先评估各场景的成本收益
   - 不是所有场景都需要GPT-4

2. 没有分级策略
   - 应该根据场景选择模型
   - 简单任务用便宜模型

3. 缺少监控
   - 没有实时成本监控
   - 发现问题时已经烧了很多钱
```

**改进**:

- 实现智能模型选择
- 建立成本监控告警
- 定期 review 成本报告

**结果**: 成本降低 60%，质量基本不变

### 5.2 失败案例 2：缓存策略失误

**背景**:

- 为了降低延迟，大量使用缓存
- 缓存 TTL 设置为 24 小时

**问题**:

- 医学知识更新后，用户仍看到旧答案
- 收到多起投诉
- 信任度下降

**反思**:

```
1. 没有考虑数据时效性
   - 医学知识会更新
   - 缓存时间过长

2. 缺少缓存失效机制
   - 知识库更新时没有清除缓存
   - 导致新旧数据不一致

3. 监控不到位
   - 没有监控缓存命中率
   - 没有发现异常
```

**改进**:

- 缩短缓存 TTL 到 1 小时
- 知识库更新时主动清除缓存
- 添加缓存版本号
- 监控缓存一致性

**结果**: 数据一致性问题解决，投诉率下降 80%

### 5.3 失败案例 3：Agent 设计过于复杂

**背景**:

- 设计了 5 个 Agent，每个负责不同环节
- 追求完美的分工

**问题**:

- Agent 间通信复杂
- 调试困难
- 延迟增加
- 维护成本高

**反思**:

```
1. 过度设计
   - 不是Agent越多越好
   - 应该根据实际需求设计

2. 没有考虑复杂度
   - Agent间通信开销
   - 状态管理复杂

3. 缺少MVP思维
   - 应该先简单实现
   - 再逐步优化
```

**改进**:

- 简化为 3 个核心 Agent
- 减少 Agent 间依赖
- 优化通信机制

**结果**: 延迟降低 40%，维护成本降低 50%

---

## 六、面试话术准备

### 6.1 项目介绍（1 分钟版）

"我最近完成了一个 AI 智能医疗问诊平台。这是一个基于大语言模型和 RAG 技术的 SaaS 产品，为用户提供 7×24 小时的 AI 医疗咨询服务。

我主要负责 AI Agent 架构设计和 RAG 系统开发。通过 Multi-Agent 协作和检索增强生成技术，实现了智能问诊、症状分析、健康建议等核心功能。

项目上线后，支撑日均 10 万+问诊请求，AI 准确率达到 85%，用户满意度 4.5 分。同时通过智能模型调度和缓存优化，将 LLM 调用成本降低了 40%。

技术栈包括 NestJS、LangChain、ChromaDB、Redis 等，整个系统采用微服务架构，可用性达到 99.9%。"

### 6.2 技术难点（3 分钟版）

"这个项目有三个主要技术难点:

**第一个是大模型幻觉问题**。医疗场景对准确性要求极高，LLM 容易编造信息。我们通过 RAG 技术将回答锚定在权威医学知识库，同时实现多轮验证和置信度评估。最终准确率从 70%提升到 85%。

**第二个是成本控制**。GPT-4 调用成本高，日均 10 万请求月成本可达 10 万美元。我们实现了智能模型选择，简单任务用 GPT-3.5，复杂任务用 GPT-4。同时通过三级缓存，命中率达到 40%。最终成本降低了 40%。

**第三个是实时性**。用户期望 3 秒内响应，但复杂问诊需要多步推理。我们通过流式输出、异步处理、并行执行等优化，将端到端延迟从 8 秒降到 3 秒，首字延迟控制在 500ms 以内。

这些优化让系统在保证质量的同时，大幅降低了成本和延迟。"

### 6.3 失败经历（2 分钟版）

"项目过程中也遇到过失败。最大的一次是缓存策略失误。

当时为了降低延迟，我们把缓存 TTL 设置为 24 小时。结果医学知识更新后，用户仍然看到旧答案，收到了多起投诉。

**问题根源**是我没有充分考虑数据时效性，也缺少缓存失效机制。

**改进措施**:

1. 缩短 TTL 到 1 小时
2. 知识库更新时主动清除缓存
3. 添加缓存版本号
4. 建立监控告警

**收获**: 这次经历让我意识到，技术方案不能只考虑性能，还要考虑数据一致性和业务特点。现在我在设计缓存策略时，会先分析数据的时效性要求，再决定 TTL 和失效策略。

最终投诉率下降了 80%，用户信任度也恢复了。"

---

## 七、面试准备 Checklist

### 技术准备

- [x] RAG 系统原理和实现细节
- [x] LangChain 核心概念和 API
- [x] 向量数据库选型和优化
- [x] Prompt Engineering 技巧
- [x] Agent 架构设计模式
- [x] 系统设计（高并发、高可用）

### 项目准备

- [x] 项目背景和业务价值
- [x] 技术架构图（能手画）
- [x] 核心技术难点和解决方案
- [x] 量化数据和成果
- [x] 失败经历和反思

### 行为面试准备

- [x] 自我介绍（1 分钟/3 分钟版本）
- [x] 项目介绍（STAR 原则）
- [x] 团队协作案例
- [x] 技术决策案例
- [x] 职业规划

### 模拟面试

- [ ] 找朋友模拟面试
- [ ] 录制视频自我 review
- [ ] 准备常见问题的答案
- [ ] 练习手绘架构图

祝面试顺利！🚀
