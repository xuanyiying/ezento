# E诊通接口文档（更新版）
1.报告解读业务： 用户上传报告 pdf 或者图片， 上传报告，调用百度ocr 进行解析识别，将识别的数据，以及患者信息发送给ai，ai进行报告解读，返回给用户；2.预问诊业务：用户在预问诊对话框和ai进行对话，用户输入自己的问题，然后将用户的问题以及用户信息发送给ai,ai进行回复；3..导诊业务: 用 户输入症状描述，情况，服务端将用户输入的信息，科室信息，医生信息，排班记录发送给ai、ai推荐科室和医生以及就诊时间。进行项目优化重构
## 1. 用户认证模块

### 1.1 用户登录
接口: /api/auth/login
方法: POST
请求参数:
```json
{
  "username": "string",
  "password": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "string",
    "userId": "string",
    "role": "PATIENT|DOCTOR",
    "userName": "string",
    "avatar": "string"
  }
}
```

### 1.2 微信一键登录
接口: /api/auth/wechat-login
方法: POST
请求参数:
```json
{
  "code": "string",   // 微信登录临时凭证
  "encryptedData": "string", // 加密数据
  "iv": "string"      // 加密算法的初始向量
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "string",
    "userId": "string",
    "role": "PATIENT|DOCTOR",
    "userName": "string",
    "avatar": "string",
    "isNewUser": "boolean" // 是否为新用户
  }
}
```

### 1.3 微信用户信息补充（首次登录）
接口: /api/auth/wechat-user-info
方法: POST
请求参数:
```json
{
  "userId": "string",
  "name": "string",
  "phone": "string",
  "gender": "string",
  "birthDate": "date",
  "role": "PATIENT"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "string",
    "profileComplete": true
  }
}
```

### 1.4 用户注册
接口: /api/auth/register
方法: POST
请求参数:
```json
{
  "username": "string",
  "password": "string",
  "name": "string",
  "phone": "string",
  "role": "PATIENT|DOCTOR"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "string"
  }
}
```

### 1.5 获取用户信息
接口: /api/auth/user-info
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "string",
    "username": "string",
    "name": "string",
    "phone": "string",
    "role": "PATIENT|DOCTOR",
    "avatar": "string",
    "gender": "string",
    "birthDate": "date",
    "joinDate": "date"
  }
}
```

## 2. 患者端接口

### 2.1 预问诊

#### 2.1.1 提交预问诊信息
接口: /api/patient/prediagnosis
方法: POST
请求参数:
```json
{
  "patientId": "string",
  "symptoms": "string",
  "duration": "string",
  "bodyParts": ["string"],
  "images": ["base64 encoded string"],
  "existingConditions": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "prediagnosisId": "string",
    "status": "SUBMITTED",
    "createTime": "timestamp"
  }
}
```

#### 2.1.2 获取预问诊记录列表
接口: /api/patient/prediagnosis/list
方法: GET
请求参数:
```
patientId: string
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "list": [{
      "prediagnosisId": "string",
      "symptoms": "string",
      "status": "SUBMITTED|PROCESSING|COMPLETED",
      "createTime": "timestamp",
      "doctorName": "string"
    }]
  }
}
```

#### 2.1.3 获取预问诊详情
接口: /api/patient/prediagnosis/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "prediagnosisId": "string",
    "patientInfo": {
      "name": "string",
      "age": "number",
      "gender": "string"
    },
    "symptoms": "string",
    "duration": "string",
    "bodyParts": ["string"],
    "images": ["url"],
    "existingConditions": "string",
    "doctorAdvice": "string",
    "status": "SUBMITTED|PROCESSING|COMPLETED",
    "createTime": "timestamp"
  }
}
```

#### 2.1.4 AI智能问诊对话
接口: /api/patient/ai-chat
方法: POST
请求参数:
```json
{
  "patientId": "string",
  "message": "string",
  "prediagnosisId": "string" // 可选，关联到一个预问诊记录
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "messageId": "string",
    "content": "string",
    "suggestions": ["string"], // 可能的后续问题建议
    "timestamp": "timestamp"
  }
}
```

#### 2.1.5 获取AI对话历史
接口: /api/patient/ai-chat/history
方法: GET
请求参数:
```
patientId: string
prediagnosisId: string (optional)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 20,
    "list": [{
      "messageId": "string",
      "sender": "USER|AI",
      "content": "string",
      "timestamp": "timestamp"
    }]
  }
}
```

### 2.2 导诊服务

#### 2.2.1 获取科室列表
接口: /api/guide/departments
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": [{
    "id": "string",
    "name": "string",
    "description": "string"
  }]
}
```

#### 2.2.2 获取推荐医生
接口: /api/guide/recommend-doctors
方法: POST
请求参数:
```json
{
  "symptoms": "string",
  "departmentId": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": [{
    "doctorId": "string",
    "name": "string",
    "department": "string",
    "title": "string",
    "specialties": "string",
    "avatar": "url",
    "rating": "number"
  }]
}
```

#### 2.2.3 医生详情
接口: /api/guide/doctor/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "doctorId": "string",
    "name": "string",
    "avatar": "url",
    "gender": "string",
    "department": "string",
    "hospital": "string",
    "title": "string",
    "specialties": "string",
    "introduction": "string",
    "rating": "number",
    "consultationCount": "number",
    "goodReviewRate": "number",
    "availableTimes": [{
      "date": "string",
      "timeSlots": ["string"]
    }]
  }
}
```

### 2.3 报告解读

#### 2.3.1 上传报告
接口: /api/patient/reports/upload
方法: POST
请求参数:
```json
{
  "patientId": "string",
  "reportType": "LABORATORY|IMAGING|PATHOLOGY",
  "reportDate": "date",
  "hospital": "string",
  "reportImages": ["base64 encoded string"],
  "description": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "reportId": "string"
  }
}
```

#### 2.3.2 获取报告列表
接口: /api/patient/reports/list
方法: GET
请求参数:
```
patientId: string
page: number
limit: number
reportType: string (optional)
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "list": [{
      "reportId": "string",
      "reportType": "LABORATORY|IMAGING|PATHOLOGY",
      "reportDate": "date",
      "hospital": "string",
      "status": "PENDING|INTERPRETED",
      "createTime": "timestamp"
    }]
  }
}
```

#### 2.3.3 获取报告详情
接口: /api/patient/reports/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "reportId": "string",
    "patientInfo": {
      "name": "string",
      "age": "number",
      "gender": "string"
    },
    "reportType": "LABORATORY|IMAGING|PATHOLOGY",
    "reportDate": "date",
    "hospital": "string",
    "reportImages": ["url"],
    "description": "string",
    "interpretation": {
      "doctorId": "string",
      "doctorName": "string",
      "content": "string",
      "createTime": "timestamp"
    },
    "status": "PENDING|INTERPRETED"
  }
}
```

#### 2.3.4 AI解读报告
接口: /api/patient/reports/ai-interpret
方法: POST
请求参数:
```json
{
  "reportId": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "interpretation": "string",
    "abnormalIndicators": [{
      "name": "string",
      "value": "string",
      "referenceRange": "string",
      "explanation": "string"
    }],
    "suggestions": "string"
  }
}
```

## 3. 医生端接口

### 3.1 患者管理

#### 3.1.1 获取患者列表
接口: /api/doctor/patients
方法: GET
请求参数:
```
doctorId: string
page: number
limit: number
keyword: string (optional)
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "list": [{
      "patientId": "string",
      "name": "string",
      "gender": "string",
      "age": "number",
      "phone": "string",
      "lastVisit": "date"
    }]
  }
}
```

#### 3.1.2 获取患者详情
接口: /api/doctor/patients/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "patientId": "string",
    "name": "string",
    "gender": "string",
    "age": "number",
    "birthDate": "date",
    "phone": "string",
    "address": "string",
    "occupation": "string",
    "medicalHistory": "string",
    "allergies": "string",
    "emergencyContact": {
      "name": "string",
      "relationship": "string",
      "phone": "string"
    }
  }
}
```

### 3.2 病历管理

#### 3.2.1 获取病历列表
接口: /api/doctor/medical-records
方法: GET
请求参数:
```
doctorId: string
patientId: string (optional)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 50,
    "list": [{
      "recordId": "string",
      "patientName": "string",
      "visitDate": "date",
      "diagnosis": "string",
      "recordType": "OUTPATIENT|INPATIENT",
      "department": "string"
    }]
  }
}
```

#### 3.2.2 获取病历详情
接口: /api/doctor/medical-records/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "recordId": "string",
    "patientInfo": {
      "id": "string",
      "name": "string",
      "gender": "string",
      "age": "number",
      "birthDate": "date",
      "occupation": "string"
    },
    "visitDate": "date",
    "department": "string",
    "doctorName": "string",
    "chiefComplaint": "string",
    "presentIllness": "string",
    "pastHistory": "string",
    "personalHistory": "string",
    "familyHistory": "string",
    "allergicHistory": "string",
    "physicalExamination": "string",
    "auxiliaryExamination": "string",
    "diagnosis": "string",
    "treatmentPlan": "string",
    "medications": [{
      "name": "string",
      "dosage": "string",
      "frequency": "string",
      "route": "string",
      "duration": "string"
    }]
  }
}
```

#### 3.2.3 创建/更新病历
接口: /api/doctor/medical-records
方法: POST
请求参数:
```json
{
  "recordId": "string (optional, 存在则更新)",
  "patientId": "string",
  "doctorId": "string",
  "visitDate": "date",
  "department": "string",
  "chiefComplaint": "string",
  "presentIllness": "string",
  "pastHistory": "string",
  "personalHistory": "string",
  "familyHistory": "string",
  "allergicHistory": "string",
  "physicalExamination": "string",
  "auxiliaryExamination": "string",
  "diagnosis": "string",
  "treatmentPlan": "string",
  "medications": [{
    "name": "string",
    "dosage": "string",
    "frequency": "string",
    "route": "string",
    "duration": "string"
  }]
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "recordId": "string"
  }
}
```

### 3.3 预问诊处理

#### 3.3.1 获取预问诊列表
接口: /api/doctor/prediagnosis/list
方法: GET
请求参数:
```
doctorId: string
status: string (optional)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 20,
    "list": [{
      "prediagnosisId": "string",
      "patientName": "string",
      "symptoms": "string",
      "status": "SUBMITTED|PROCESSING|COMPLETED",
      "createTime": "timestamp"
    }]
  }
}
```

#### 3.3.2 获取预问诊详情
接口: /api/doctor/prediagnosis/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "prediagnosisId": "string",
    "patientInfo": {
      "id": "string",
      "name": "string",
      "gender": "string",
      "age": "number"
    },
    "symptoms": "string",
    "duration": "string",
    "bodyParts": ["string"],
    "images": ["url"],
    "existingConditions": "string",
    "doctorAdvice": "string",
    "status": "SUBMITTED|PROCESSING|COMPLETED",
    "createTime": "timestamp"
  }
}
```

#### 3.3.3 提交预问诊建议
接口: /api/doctor/prediagnosis/advice
方法: POST
请求参数:
```json
{
  "prediagnosisId": "string",
  "doctorId": "string",
  "advice": "string",
  "recommendDepartment": "string",
  "urgencyLevel": "NORMAL|URGENT|EMERGENCY"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "updated": true
  }
}
```

### 3.4 报告解读

#### 3.4.1 获取待解读报告列表
接口: /api/doctor/reports/list
方法: GET
请求参数:
```
doctorId: string
status: string (optional)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 15,
    "list": [{
      "reportId": "string",
      "patientName": "string",
      "reportType": "LABORATORY|IMAGING|PATHOLOGY",
      "reportDate": "date",
      "hospital": "string",
      "status": "PENDING|INTERPRETED",
      "createTime": "timestamp"
    }]
  }
}
```

#### 3.4.2 提交报告解读
接口: /api/doctor/reports/interpret
方法: POST
请求参数:
```json
{
  "reportId": "string",
  "doctorId": "string",
  "interpretation": "string",
  "findings": "string",
  "recommendations": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "updated": true
  }
}
```

### 3.5 处方管理

#### 3.5.1 创建处方
接口: /api/doctor/prescriptions
方法: POST
请求参数:
```json
{
  "patientId": "string",
  "doctorId": "string",
  "recordId": "string",
  "diagnosis": "string",
  "medications": [{
    "name": "string",
    "specification": "string",
    "dosage": "string",
    "frequency": "string",
    "route": "string",
    "duration": "string",
    "quantity": "number",
    "notes": "string"
  }],
  "notes": "string"
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "prescriptionId": "string"
  }
}
```

#### 3.5.2 获取处方列表
接口: /api/doctor/prescriptions/list
方法: GET
请求参数:
```
doctorId: string
patientId: string (optional)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 30,
    "list": [{
      "prescriptionId": "string",
      "patientName": "string",
      "createTime": "timestamp",
      "diagnosis": "string",
      "status": "DRAFT|ISSUED|FILLED"
    }]
  }
}
```

#### 3.5.3 获取处方详情
接口: /api/doctor/prescriptions/{id}
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "prescriptionId": "string",
    "patientInfo": {
      "id": "string",
      "name": "string",
      "gender": "string",
      "age": "number",
      "weight": "number"
    },
    "doctorInfo": {
      "id": "string",
      "name": "string",
      "department": "string",
      "title": "string"
    },
    "diagnosis": "string",
    "medications": [{
      "name": "string",
      "specification": "string",
      "dosage": "string",
      "frequency": "string",
      "route": "string",
      "duration": "string",
      "quantity": "number",
      "notes": "string"
    }],
    "notes": "string",
    "createTime": "timestamp",
    "status": "DRAFT|ISSUED|FILLED"
  }
}
```

## 4. 个人中心接口

### 4.1 获取个人信息
接口: /api/user/profile
方法: GET
请求参数:
```
userId: string
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "string",
    "name": "string",
    "avatar": "string",
    "gender": "string",
    "age": "number",
    "phone": "string",
    "role": "PATIENT|DOCTOR",
    "medicalCardId": "string",
    "healthInfo": {
      "height": "number",
      "weight": "number",
      "bloodType": "string"
    }
  }
}
```

### 4.2 更新个人信息
接口: /api/user/profile
方法: PUT
请求参数:
```json
{
  "userId": "string",
  "name": "string",
  "avatar": "string",
  "gender": "string",
  "birthDate": "date",
  "phone": "string",
  "healthInfo": {
    "height": "number",
    "weight": "number",
    "bloodType": "string"
  }
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "updated": true
  }
}
```

### 4.3 获取就诊记录
接口: /api/user/medical-history
方法: GET
请求参数:
```
userId: string
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "list": [{
      "recordId": "string",
      "visitDate": "date",
      "hospital": "string",
      "department": "string",
      "doctorName": "string",
      "diagnosis": "string",
      "type": "OUTPATIENT|INPATIENT|EMERGENCY"
    }]
  }
}
```

### 4.4 获取预约记录
接口: /api/user/appointments
方法: GET
请求参数:
```
userId: string
status: string (optional) (UPCOMING|COMPLETED|CANCELLED)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 5,
    "list": [{
      "appointmentId": "string",
      "doctorName": "string",
      "department": "string",
      "hospital": "string",
      "appointmentTime": "datetime",
      "status": "UPCOMING|COMPLETED|CANCELLED",
      "consultationType": "ONLINE|OFFLINE"
    }]
  }
}
```

### 4.5 获取消息通知
接口: /api/user/notifications
方法: GET
请求参数:
```
userId: string
read: boolean (optional)
page: number
limit: number
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 20,
    "unreadCount": 5,
    "list": [{
      "notificationId": "string",
      "title": "string",
      "content": "string",
      "type": "APPOINTMENT|REPORT|PRESCRIPTION|SYSTEM",
      "isRead": "boolean",
      "createTime": "timestamp",
      "relatedId": "string", // 相关联的记录ID
      "relatedType": "string" // 相关联的记录类型
    }]
  }
}
```

### 4.6 标记通知为已读
接口: /api/user/notifications/read
方法: POST
请求参数:
```json
{
  "notificationIds": ["string"],
  "allRead": "boolean" // 是否标记全部为已读
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "updated": true
  }
}
```

## 5. 通用接口

### 5.1 文件上传
接口: /api/files/upload
方法: POST
请求参数:
```
file: multipart/form-data
type: string (IMAGE|DOCUMENT|REPORT)
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "fileId": "string",
    "url": "string"
  }
}
```

### 5.2 系统配置
接口: /api/system/config
方法: GET
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "departments": [{
      "id": "string",
      "name": "string"
    }],
    "reportTypes": ["LABORATORY", "IMAGING", "PATHOLOGY"],
    "medicationRoutes": ["ORAL", "INJECTION", "TOPICAL"]
  }
}
```

### 5.3 获取服务条款和隐私政策
接口: /api/system/terms
方法: GET
请求参数:
```
type: string (TERMS|PRIVACY)
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "title": "string",
    "content": "string",
    "lastUpdated": "date"
  }
}
```

### 5.4 意见反馈
接口: /api/system/feedback
方法: POST
请求参数:
```json
{
  "userId": "string",
  "type": "BUG|SUGGESTION|COMPLAINT",
  "content": "string",
  "contactInfo": "string",
  "images": ["base64 encoded string"]
}
```
响应:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "feedbackId": "string",
    "submitted": true
  }
}
``` 